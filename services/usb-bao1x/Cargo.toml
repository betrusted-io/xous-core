[package]
name = "usb-bao1x"
version = "0.1.0"
edition = "2021"

[dependencies]
utralib = { version = "0.1.26", optional = true, default-features = false }
xous-names = { package = "xous-api-names", version = "0.9.68" }
ticktimer = { package = "xous-api-ticktimer", version = "0.9.66" }
xous = "0.9.67"
xous-ipc = "0.10.7"
log-server = { package = "xous-api-log", version = "0.1.66" }
log = "0.4.14"
num-derive = { version = "0.4.2", default-features = false }
num-traits = { version = "0.2.14", default-features = false }
bao1x-hal = { path = "../../libs/bao1x-hal", features = [
    "std",
    # "debug-print-usb",
    # "verbose-debug",
    "axp2101",
], optional = true }
bao1x-api = { path = "../../libs/bao1x-api" }
bao1x-hal-service = { path = "../bao1x-hal-service", optional = true }
bao1x-emu = { path = "../bao1x-emu", optional = true }
xous-usb-hid = { git = "https://github.com/betrusted-io/xous-usb-hid.git", branch = "main" }
rkyv = { version = "0.8.8", default-features = false, features = [
    "std",
    "alloc",
] }
packed_struct = { version = "0.10", default-features = false } # used by the xous-usb-hid crate
locales = { path = "../../locales" }
frunk_core = "0.4.2"
# for debugging interrupts
riscv = { version = "0.5.6", package = "xous-riscv" }

usb-device = { git = "https://github.com/betrusted-io/usb-device.git", branch = "main", features = [
    "log",
    "control-buffer-256",
] }
# usb-device = { path = "../../../usb-device", features = [
#     "log",
#     "control-buffer-256",
# ] }

# Serial support
usbd-serial = { git = "https://github.com/betrusted-io/usbd-serial.git", branch = "v0.1.1-betrusted", features = [
    "max-packet-size-512",
] }
# usbd-serial = { path = "../../../usbd-serial", features = [
#     "max-packet-size-512",
# ] }

[features]
bao1x = []
board-baosec = [
    "utralib/bao1x",
    "utralib/std",
    "bao1x-hal",
    "bao1x-hal-service",
]
board-dabao = ["utralib/bao1x", "utralib/std", "bao1x-hal", "bao1x-hal-service"]
hosted-baosec = ["utralib/hosted", "utralib/std", "bao1x-emu"]
# none of these other modes are actually supported, but are listed here
# to allow direct re-use of API code
precursor = ["utralib/precursor", "utralib/std"]
hosted = ["utralib/hosted", "utralib/std"]
renode = ["utralib/renode", "utralib/std"]
mass-storage = []
debug-print-usb = [
    "bao1x-hal/debug-print-duart",
] # mutually exclusive feature with other crates that use the app UART
verbose-debug = ["bao1x-hal/verbose-debug"]

# mutually exclusive with kernel "print-panics"; will get a DUART allocation error on boot if kernel panics are on
# sticks the DUART into the deep stack; necessary because we can't have external dependencies in usbd-device
# and the DUART can be banged with simple hard-coded memory offsets.
usbd-debug = ["usb-device/baochip-debug"]

prototyping = [
] # temporary feature-out for figuring out the code; remove this if you don't recognize it anymore

default = []
